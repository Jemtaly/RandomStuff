# VidXXC

VidXXC 是一个可用于直播的视频加解密工具。其中，加密端可使用特定密钥将输入视频加密成一段难以辨认出任何有用信息的随机视频，而解密端则可根据相同密钥实时解密出原始视频内容。

[out.webm](https://github.com/Jemtaly/VidXXC/assets/83796250/8c30203b-718b-4e39-8c62-f6424c025661)

## 使用方法

- 安装所需的 Python 第三方库

  ```
  pip install pycryptodome
  pip install numpy
  pip install Pillow
  pip install opencv-python
  ```

- 服务端（加密端）

  ```
  python3 videnc.py -s your/video/to/encrypt.xxx -d out.avi -k 12345678abcdef12345678abcdef
  ```

  使用密钥 `12345678abcdef12345678abcdef` 将输入的视频 your/video/to/encrypt.xxx（任意格式）加密到 out.avi（使用 AES-128 算法 CTR 加密模式）。

  ```
  可选参数：

  -n NUM  密文中每一帧的最大像素数量。（默认值：60000）
          注意，这一参数并不直接决定输出视频文件的分辨率，而决定的是密文的每一
          帧中最多包含多少独立的像素点，换句话说，决定的是客户端解密后的视频的
          分辨率。程序在对视频进行加密时会根据该参数输出类似于 `Ciphertext
          resolution: WIDTH x HEIGHT` 的信息，客户端解密时需要用到这里输出的
          宽和高。
  
  -r RED  密文中每个像素的边长和输出视频中每个像素边长的比值。（默认值：4）
          例如，假如密文本身的分辨率是 320x180，而该参数被设置为 4，那么最终输
          出的加密视频文件的分辨率会是 1280x720（密文中每个像素在输出视频中对应
          4x4 个像素）。由于视频编码时会对视频内容进行压缩，故如果该参数设置过
          小，会导致密文中的像素在缩放放大后糊成一团，影响解密效果。
  
  -l LEN  视频左上角的随机水印的每个像素边长和密文每个像素的边长的比值。（默
          认：2）
          注：该水印作用见 FAQ。
  ```

- 客户端（解密端）

  打开正在播放的视频，执行以下命令：（如果加密时使用了 `-l` 参数，请在加密时也加上相同的参数）

  ```
  python3 viddec.py -k 12345678abcdef12345678abcdef -r WIDTH HEIGHT
  ```

  其中 WIDTH 和 HEIGHT 为加密时输出的对应数值。然后，会同时弹出画面选取窗口和解密画面窗口。把画面选取窗口拖放到正在播放的视频上方，调整窗口大小使其刚好覆盖住视频画面，当准确覆盖画面时，解密窗口中就会出现解密后的视频画面。双击解密窗口可隐藏或重新调出画面选则器。

## FAQ
  
- 为什么要使用 CTR 模式？

  视频在储存和传输过程中会被压缩。这会导致视频像素 RGB 的低位发生改变。CTR 模式会将块密码转化为流密码，直接将明文与用户密钥生成的密钥流进行异或处理，从而获得密文。这意味着每个比特在加密和解密过程中都是独立的——因压缩而发生变化的低比特不会影响高比特的解密。这确保了压缩对视频内容的影响最小。而如果使用其他加密模式，如 ECB、CBC、CFB 等，那么密文中任何一个比特的变化都会导致该比特所在的整个数据块完全解密错误。此外，ECB 模式还存在无法抵御统计分析的问题。

- 左上角的随机水印的作用是什么？

  由于 CTR 模式是使用异或运算进行加密的，如果使用相同的密钥多次加密不同信息，则每次加密都应使用不同的 IV，否则会泄露出明文中的信息（见下方演示）。因此，程序会在加密过程时为视频的每一帧生成不同的随机 IV，并将其标记在加密后画面的左上角。解密时，程序会首先分析该水印以得到当前帧的随机 IV，然后根据它和用户密钥共同进行解密。
  
  [example.webm](https://github.com/Jemtaly/VidXXC/assets/83796250/2c832009-e16f-4789-b866-7fd9bc0882c6)
